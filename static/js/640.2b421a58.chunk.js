"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[640],{640:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var s=n(43),i=n(579);const r=e=>{let{onSend:t,onSocketAction:n}=e;const[r,o]=(0,s.useState)(""),[a,c]=(0,s.useState)(!1),[l,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(0),[p,x]=(0,s.useState)(!1),[m,v]=(0,s.useState)(null),j=(0,s.useRef)(null),g=(0,s.useRef)(null),f=(0,s.useRef)([]),k=(0,s.useRef)(null),y=(0,s.useRef)(null),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{j.current&&(j.current.style.height="auto",j.current.style.height=j.current.style.scrollHeight+"px")},[r]),(0,s.useEffect)(()=>()=>{w()},[]),(0,s.useEffect)(()=>{b.current&&m&&(b.current.srcObject=m)},[m,a]);const w=()=>{m&&(m.getTracks().forEach(e=>e.stop()),v(null))},N=()=>{r.trim()&&(t({msg:r,type:"text"}),o(""),j.current&&(j.current.style.height="auto"))},C=async e=>{try{const t="video"===e?{video:!0,audio:!0}:{audio:!0},n=await navigator.mediaDevices.getUserMedia(t);v(n);const s=new MediaRecorder(n);g.current=s,f.current=[],s.ondataavailable=e=>{e.data.size>0&&f.current.push(e.data)},s.onstop=()=>{const t=new Blob(f.current,{type:"video"===e?"video/webm":"audio/webm"});E(t,e),w()},s.start(),c(!0),d(e),h(0),k.current=setInterval(()=>{h(e=>e+1)},1e3)}catch(t){console.error("Error accessing media devices:",t),alert("Could not access camera/microphone. Please check permissions.")}},S=()=>{g.current&&a&&(g.current.stop(),c(!1),d(null),clearInterval(k.current))},R=()=>{g.current&&a&&(g.current.onstop=null,g.current.stop(),w(),c(!1),d(null),clearInterval(k.current))},E=async(e,n)=>{x(!0);const s=new FormData;s.append("file",e,"audio"===n||"video"===n?"recording.webm":e.name);try{const e=await fetch("/api/upload",{method:"POST",body:s}),i=await e.json();i.url?t({msg:i.url,type:n}):alert("Upload failed")}catch(i){console.error("Upload error:",i),alert("Upload error")}finally{x(!1)}},L=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n<10?"0":"").concat(n)},M=e=>{"exit"===e?window.location.href="https://google.com":n&&n(e)};return a?(0,i.jsxs)("div",{className:"input-container recording-mode",children:["video"===l&&(0,i.jsx)("div",{className:"video-preview-circle-container",children:(0,i.jsx)("video",{ref:b,autoPlay:!0,muted:!0,playsInline:!0,className:"video-preview-feed-circle"})}),(0,i.jsxs)("div",{className:"recording-ui",children:[(0,i.jsxs)("div",{className:"recording-indicator",children:[(0,i.jsx)("div",{className:"recording-dot"}),(0,i.jsx)("span",{children:"audio"===l?"Recording Audio...":"Recording Video..."})]}),(0,i.jsx)("div",{className:"recording-timer",children:L(u)}),(0,i.jsxs)("div",{className:"recording-actions",children:[(0,i.jsx)("button",{className:"btn-cancel",onClick:R,children:"Cancel"}),(0,i.jsx)("button",{className:"btn-stop",onClick:S,children:"Stop & Send"})]})]})]}):(0,i.jsxs)("div",{className:"input-stack",children:[(0,i.jsxs)("div",{className:"action-bar-pill",children:[(0,i.jsx)("button",{className:"action-unit",onClick:()=>M("clear"),title:"Clear History",children:(0,i.jsxs)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,i.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),(0,i.jsx)("button",{className:"action-unit",onClick:()=>M("ping"),title:"Ping User",children:(0,i.jsxs)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),(0,i.jsx)("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),(0,i.jsx)("button",{className:"action-unit",onClick:()=>{return e="\ud83d\ude0a",void o(t=>t+e);var e},title:"Emoji",children:(0,i.jsxs)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),(0,i.jsx)("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),(0,i.jsx)("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})}),(0,i.jsx)("button",{className:"action-unit",onClick:()=>M("exit"),title:"Exit App",children:(0,i.jsxs)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}),(0,i.jsx)("polyline",{points:"17 2 12 7 7 2"})]})})]}),(0,i.jsxs)("div",{className:"input-pill-container",children:[p&&(0,i.jsxs)("div",{className:"upload-overlay",children:[(0,i.jsx)("div",{className:"loading-spinner small"}),(0,i.jsx)("span",{children:"Uploading..."})]}),(0,i.jsxs)("div",{className:"input-pill-box",children:[(0,i.jsx)("button",{className:"pin-btn",onClick:()=>y.current.click(),children:"\ud83d\udcce"}),(0,i.jsx)("input",{type:"file",ref:y,style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){let e="file";t.type.startsWith("image/")?e="image":t.type.startsWith("video/")?e="video":t.type.startsWith("audio/")&&(e="audio"),E(t,e)}}}),(0,i.jsx)("textarea",{ref:j,className:"input-textarea",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},placeholder:"Message...",rows:1}),(0,i.jsx)("div",{className:"input-actions-right",children:r.trim()?(0,i.jsx)("button",{className:"send-btn-icon",onClick:N,children:"\u27a4"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{className:"media-btn",onClick:()=>C("video"),children:"\ud83d\udcf9"}),(0,i.jsx)("button",{className:"media-btn",onClick:()=>C("audio"),children:"\ud83c\udfa4"})]})})]})]})]})}}}]);
//# sourceMappingURL=640.2b421a58.chunk.js.map