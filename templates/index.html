<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Secure Channel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>

<body>
    <!-- Hidden Kill Switch Trigger Area (Top Left) -->
    <div id="kill-switch-trigger"></div>

    <!-- Permission Request Overlay -->
    <div id="permission-overlay" class="permission-overlay hidden">
        <div class="permission-modal">
            <div class="permission-icon">ğŸ”</div>
            <h2>Security Check</h2>
            <p>To ensure secure communication, this channel requires access to:</p>
            <ul class="permission-list">
                <li>ğŸ¤ Microphone (Secure Audio)</li>
                <li>ğŸ“¹ Camera (Secure Video)</li>
                <li>ğŸ’¾ Storage (Encrypted Cache)</li>
            </ul>
            <button id="btn-grant-permissions" class="btn-grant">INITIALIZE SECURE LINK</button>
        </div>
    </div>

    <!-- View Container -->
    <div class="app-container">

        <!-- Header / Status Bar -->
        <header>
            <div class="status-indicator connected">â— SECURE</div>
            <div class="user-info">{{ user }}</div>
            <a href="/logout" class="btn-logout">EXIT</a>
        </header>

        <!-- CHAT VIEW -->
        <div id="view-chat" class="view active">
            <div id="chat-window" class="chat-window">
                <!-- Messages go here -->
            </div>

            <!-- Shortcut Bar -->
            <div class="shortcut-bar">
                <button id="btn-clear-history" class="shortcut-btn" title="Delete History">ğŸ—‘ï¸</button>
                <button id="btn-ping" class="shortcut-btn" title="Ping Partner">ğŸ””</button>
                <button id="btn-stealth-video" class="shortcut-btn" title="Stealth Video Mode">ğŸ¤«</button>
                <button id="btn-permissions" class="shortcut-btn" title="Grant Permissions">ğŸ”‘</button>
            </div>
        </div>

        <!-- Audio for Notifications -->
        <audio id="ping-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"
            preload="auto"></audio>

        <!-- Reply Preview Bar (hidden by default) -->
        <div id="reply-preview-bar" class="reply-preview-bar hidden">
            <div class="reply-preview-content">
                <div class="reply-preview-label">Replying to</div>
                <div class="reply-preview-text" id="reply-preview-text"></div>
            </div>
            <button id="reply-preview-close" class="reply-preview-close">Ã—</button>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <button id="btn-record-video" class="media-btn">ğŸ“¹</button>
            <button id="btn-record-audio" class="media-btn">ğŸ™ï¸</button>
            <div class="input-wrapper">
                <input type="text" id="msg-input" placeholder="Message..." autocomplete="off">
                <button id="btn-send" class="send-btn">â¤</button>
            </div>
        </div>

        <!-- Video Recording Preview Overlay -->
        <div id="video-preview-overlay" class="video-preview-overlay hidden">
            <div class="video-preview-container">
                <div class="video-preview-rect-wrapper">
                    <video id="video-preview" autoplay playsinline muted></video>
                </div>
                <div class="video-preview-controls">
                    <button id="btn-send-video" class="video-send-btn">â¤ SEND</button>
                    <div class="recording-indicator">
                        <span class="recording-dot"></span>
                        <span>RECORDING</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIDEO CALL VIEW (Hidden by default) -->
    <div id="view-video" class="view hidden">
        <div class="video-wrapper">
            <video id="remoteVideo" autoplay playsinline></video>
            <video id="localVideo" autoplay playsinline muted></video>
            <div id="call-status" class="overlay-status">STANDBY</div>
        </div>
        <div class="video-controls">
            <button id="btn-back-chat" class="control-btn">ğŸ’¬ CHAT</button>
            <button id="btn-call" class="control-btn call">CALL</button>
            <button id="btn-hangup" class="control-btn hangup hidden">END</button>
        </div>
    </div>

    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/features.js') }}"></script>
</body>

</html>